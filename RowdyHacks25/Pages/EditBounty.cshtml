@page
@model RowdyHacks25.Pages.EditBountyModel
@{
    ViewData["Title"] = "Edit Bounty";
}

<link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@600&display=swap" rel="stylesheet">

<div class="space-card" style="max-width: 600px;">
    <h1 class="space-title">üõ†Ô∏è Edit Bounty</h1>

    @if (!string.IsNullOrEmpty(Model.ErrorMessage))
    {
        <div class="alert alert-danger">
            @Model.ErrorMessage
        </div>
    }

    <form method="post">
        <input type="hidden" asp-for="EditingBounty.Id" />

        <div class="mb-3">
            <label asp-for="EditingBounty.TargetName" class="form-label">Target Name</label>
            <input asp-for="EditingBounty.TargetName" class="form-control" required />
        </div>

        <div class="mb-3">
            <label asp-for="EditingBounty.Planet" class="form-label">Last Known Planet</label>
            <input asp-for="EditingBounty.Planet" class="form-control" required />
        </div>

        <div class="mb-3">
            <label asp-for="EditingBounty.Reward" class="form-label">Reward (‚Ç°)</label>
            <input asp-for="EditingBounty.Reward" type="number" class="form-control" min="0" step="100" required />
        </div>

        <div class="mb-3">
            <label asp-for="EditingBounty.DangerLevel" class="form-label">Danger Level</label>
            <select asp-for="EditingBounty.DangerLevel" class="form-select">
                <option>Low</option>
                <option>Medium</option>
                <option>High</option>
                <option>Extreme</option>
            </select>
        </div>

        <div class="mb-3">
            <label asp-for="EditingBounty.ImageUrl" class="form-label">Image Address (URL)</label>
            <input asp-for="EditingBounty.ImageUrl" type="url" class="form-control" />
        </div>

        <div class="mb-4">
            <label asp-for="OwnerKeyInput" class="form-label">Owner Key</label>
            <input asp-for="OwnerKeyInput" class="form-control" required="@(!string.IsNullOrEmpty(Model.EditingBounty.ManagerId))" />
            <small class="text-muted" style="color: #ff9500 !important;">
                @if (!string.IsNullOrEmpty(Model.EditingBounty.ManagerId))
                {
                    <span>Enter your secret owner key to verify ownership</span>
                }
                else
                {
                    <span>This bounty has no owner - anyone can edit it</span>
                }
            </small>
        </div>

        <div class="d-flex gap-2">
            <button type="submit" class="space-btn">Save Changes</button>
            <a href="/ViewBounty?id=@Model.EditingBounty.Id" class="space-btn" style="background-color: #6c757d;">Cancel</a>
        </div>
    </form>

    <!-- DELETE FORM (separate form; do not nest) -->
    <form method="post"
          asp-page-handler="Delete"
          asp-route-id="@Model.EditingBounty.Id"
          class="mt-3"
          style="display:flex; gap:.5rem; align-items:center;">
        @* Only ask for the key if there is an owner *@
        @if (!string.IsNullOrEmpty(Model.EditingBounty.ManagerId))
        {
            <input asp-for="OwnerKeyInput"
                   class="form-control"
                   placeholder="Owner key to confirm deletion"
                   required />
        }
        <button type="submit" class="space-btn space-btn-danger"
                onclick="return confirm('Delete this bounty permanently?');">
            Delete Bounty
        </button>
    </form>
</div>

<style>
    /* optional danger style */
    .space-btn-danger {
        background: #dc3545;
    }

        .space-btn-danger:hover {
            filter: brightness(.95);
        }
</style>
